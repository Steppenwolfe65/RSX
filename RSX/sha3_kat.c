#include "sha3_kat.h"
#include "../RSX/sha3.h"
#include <stdio.h>

static bool are_equal8(const uint8_t* a, const uint8_t* b, size_t length)
{
	bool status;
	size_t i;

	status = true;

	for (i = 0; i < length; ++i)
	{
		if (a[i] != b[i])
		{
			status = false;
			break;
		}
	}

	return status;
}

static void clear8(uint8_t* a, size_t count)
{
	size_t i;

	for (i = 0; i < count; ++i)
	{
		a[i] = 0;
	}
}

static void clear64(uint64_t* a, size_t count)
{
	size_t i;

	for (i = 0; i < count; ++i)
	{
		a[i] = 0;
	}
}

static void hex_to_bin(const char* hexstr, uint8_t* output, size_t length)
{
	size_t  pos;
	uint8_t  idx0;
	uint8_t  idx1;

	const uint8_t hashmap[] =
	{
		0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
		0x08, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

	memset(output, 0, length);

	for (pos = 0; pos < (length * 2); pos += 2)
	{
		idx0 = ((uint8_t)hexstr[pos + 0] & 0x1F) ^ 0x10;
		idx1 = ((uint8_t)hexstr[pos + 1] & 0x1F) ^ 0x10;
		output[pos / 2] = (uint8_t)(hashmap[idx0] << 4) | hashmap[idx1];
	}
}

bool sha3_256_kat_test()
{
	uint8_t exp0[32];
	uint8_t exp24[32];
	uint8_t exp448[32];
	uint8_t exp1600[32];
	uint8_t hash[200];
	uint8_t msg0[1];
	uint8_t msg24[3];
	uint8_t msg448[56];
	uint8_t msg1600[200];
	uint8_t output[32];
	uint64_t state[25];
	size_t offset;
	bool status;

	hex_to_bin("A7FFC6F8BF1ED76651C14756A061D662F580FF4DE43B49FA82D80A4B80F8434A", exp0, 32);
	hex_to_bin("3A985DA74FE225B2045C172D6BD390BD855F086E3E9D525B46BFE24511431532", exp24, 32);
	hex_to_bin("41C0DBA2A9D6240849100376A8235E2C82E1B9998A999E21DB32DD97496D3376", exp448, 32);
	hex_to_bin("79F38ADEC5C20307A98EF76E8324AFBFD46CFD81B22E3973C65FA1BD9DE31787", exp1600, 32);

	hex_to_bin("0", msg0, 1);
	hex_to_bin("616263", msg24, 3);
	hex_to_bin("6162636462636465636465666465666765666768666768696768696A68696A6B"
		"696A6B6C6A6B6C6D6B6C6D6E6C6D6E6F6D6E6F706E6F7071", msg448, 56);
	hex_to_bin("A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 32);
	sha3_compute256(output, msg0, 0);

	if (are_equal8(output, exp0, 32) == false)
	{
		status = false;
	}

	clear8(output, 32);
	sha3_compute256(output, msg24, 3);

	if (are_equal8(output, exp24, 32) == false)
	{
		status = false;
	}

	clear8(output, 32);
	sha3_compute256(output, msg448, 56);

	if (are_equal8(output, exp448, 32) == false)
	{
		status = false;
	}

	clear8(output, 32);
	sha3_compute256(output, msg1600, 200);

	if (are_equal8(output, exp1600, 32) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear8(hash, 200);
	clear64(state, 25);

	/* if message is less than one full block, just call finalize */
	sha3_finalize(state, SHA3_256_RATE, msg0, 0, hash);

	if (are_equal8(hash, exp0, 32) == false)
	{
		status = false;
	}

	clear8(hash, 200);
	clear64(state, 25);
	sha3_finalize(state, SHA3_256_RATE, msg24, 3, hash);

	if (are_equal8(hash, exp24, 32) == false)
	{
		status = false;
	}

	clear8(hash, 200);
	clear64(state, 25);
	sha3_finalize(state, SHA3_256_RATE, msg448, 56, hash);

	if (are_equal8(hash, exp448, 32) == false)
	{
		status = false;
	}

	clear8(hash, 200);
	clear64(state, 25);
	offset = 0;

	/* absorb a rate sized block */
	sha3_blockupdate(state, SHA3_256_RATE, msg1600, 1);
	/* finalize the message */
	sha3_finalize(state, SHA3_256_RATE, msg1600 + SHA3_256_RATE, 200 - SHA3_256_RATE, hash);

	if (are_equal8(hash, exp1600, 32) == false)
	{
		status = false;
	}

	return status;
}

bool sha3_512_kat_test()
{
	uint8_t exp0[64];
	uint8_t exp24[64];
	uint8_t exp448[64];
	uint8_t exp1600[64];
	uint8_t hash[200];
	uint8_t msg0[1];
	uint8_t msg24[3];
	uint8_t msg448[56];
	uint8_t msg1600[200];
	uint8_t output[64];
	uint64_t state[25];
	size_t offset;
	bool status;

	hex_to_bin("A69F73CCA23A9AC5C8B567DC185A756E97C982164FE25859E0D1DCC1475C80A6"
		"15B2123AF1F5F94C11E3E9402C3AC558F500199D95B6D3E301758586281DCD26", exp0, 64);
	hex_to_bin("B751850B1A57168A5693CD924B6B096E08F621827444F70D884F5D0240D2712E"
		"10E116E9192AF3C91A7EC57647E3934057340B4CF408D5A56592F8274EEC53F0", exp24, 64);
	hex_to_bin("04A371E84ECFB5B8B77CB48610FCA8182DD457CE6F326A0FD3D7EC2F1E91636D"
		"EE691FBE0C985302BA1B0D8DC78C086346B533B49C030D99A27DAF1139D6E75E", exp448, 64);
	hex_to_bin("E76DFAD22084A8B1467FCF2FFA58361BEC7628EDF5F3FDC0E4805DC48CAEECA8"
		"1B7C13C30ADF52A3659584739A2DF46BE589C51CA1A4A8416DF6545A1CE8BA00", exp1600, 64);

	hex_to_bin("0", msg0, 1);
	hex_to_bin("616263", msg24, 3);
	hex_to_bin("6162636462636465636465666465666765666768666768696768696A68696A6B"
		"696A6B6C6A6B6C6D6B6C6D6E6C6D6E6F6D6E6F706E6F7071", msg448, 56);
	hex_to_bin("A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 64);
	sha3_compute512(output, msg0, 0);

	if (are_equal8(output, exp0, 64) == false)
	{
		status = false;
	}

	clear8(output, 64);
	sha3_compute512(output, msg24, 3);

	if (are_equal8(output, exp24, 64) == false)
	{
		status = false;
	}

	clear8(output, 64);
	sha3_compute512(output, msg448, 56);

	if (are_equal8(output, exp448, 64) == false)
	{
		status = false;
	}

	clear8(output, 64);
	sha3_compute512(output, msg1600, 200);

	if (are_equal8(output, exp1600, 64) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear8(hash, 200);
	clear64(state, 25);
	sha3_finalize(state, SHA3_512_RATE, msg0, 0, hash);

	if (are_equal8(hash, exp0, 64) == false)
	{
		status = false;
	}

	clear8(hash, 200);
	clear64(state, 25);
	sha3_finalize(state, SHA3_512_RATE, msg24, 3, hash);

	if (are_equal8(hash, exp24, 64) == false)
	{
		status = false;
	}

	clear8(hash, 200);
	clear64(state, 25);
	sha3_finalize(state, SHA3_512_RATE, msg448, 56, hash);

	if (are_equal8(hash, exp448, 64) == false)
	{
		status = false;
	}

	clear8(hash, 200);
	clear64(state, 25);
	offset = 0;

	/* absorb a rate sized block */
	sha3_blockupdate(state, SHA3_512_RATE, msg1600, 1);
	/* finalize the message */
	sha3_finalize(state, SHA3_512_RATE, msg1600 + SHA3_512_RATE, 200 - SHA3_512_RATE, hash);

	if (are_equal8(hash, exp1600, 64) == false)
	{
		status = false;
	}

	return status;
}

bool shake_128_kat_test()
{
	uint8_t exp0[512];
	uint8_t exp1600[512];
	uint8_t hash[512];
	uint8_t msg0[1];
	uint8_t msg1600[200];
	uint8_t output[512];
	uint64_t state[25];
	bool status;

	hex_to_bin("7F9C2BA4E88F827D616045507605853ED73B8093F6EFBC88EB1A6EACFA66EF26"
		"3CB1EEA988004B93103CFB0AEEFD2A686E01FA4A58E8A3639CA8A1E3F9AE57E2"
		"35B8CC873C23DC62B8D260169AFA2F75AB916A58D974918835D25E6A435085B2"
		"BADFD6DFAAC359A5EFBB7BCC4B59D538DF9A04302E10C8BC1CBF1A0B3A5120EA"
		"17CDA7CFAD765F5623474D368CCCA8AF0007CD9F5E4C849F167A580B14AABDEF"
		"AEE7EEF47CB0FCA9767BE1FDA69419DFB927E9DF07348B196691ABAEB580B32D"
		"EF58538B8D23F87732EA63B02B4FA0F4873360E2841928CD60DD4CEE8CC0D4C9"
		"22A96188D032675C8AC850933C7AFF1533B94C834ADBB69C6115BAD4692D8619"
		"F90B0CDF8A7B9C264029AC185B70B83F2801F2F4B3F70C593EA3AEEB613A7F1B"
		"1DE33FD75081F592305F2E4526EDC09631B10958F464D889F31BA010250FDA7F"
		"1368EC2967FC84EF2AE9AFF268E0B1700AFFC6820B523A3D917135F2DFF2EE06"
		"BFE72B3124721D4A26C04E53A75E30E73A7A9C4A95D91C55D495E9F51DD0B5E9"
		"D83C6D5E8CE803AA62B8D654DB53D09B8DCFF273CDFEB573FAD8BCD45578BEC2"
		"E770D01EFDE86E721A3F7C6CCE275DABE6E2143F1AF18DA7EFDDC4C7B70B5E34"
		"5DB93CC936BEA323491CCB38A388F546A9FF00DD4E1300B9B2153D2041D205B4"
		"43E41B45A653F2A5C4492C1ADD544512DDA2529833462B71A41A45BE97290B6F", exp0, 512);

	hex_to_bin("131AB8D2B594946B9C81333F9BB6E0CE75C3B93104FA3469D3917457385DA037"
		"CF232EF7164A6D1EB448C8908186AD852D3F85A5CF28DA1AB6FE343817197846"
		"7F1C05D58C7EF38C284C41F6C2221A76F12AB1C04082660250802294FB871802"
		"13FDEF5B0ECB7DF50CA1F8555BE14D32E10F6EDCDE892C09424B29F597AFC270"
		"C904556BFCB47A7D40778D390923642B3CBD0579E60908D5A000C1D08B98EF93"
		"3F806445BF87F8B009BA9E94F7266122ED7AC24E5E266C42A82FA1BBEFB7B8DB"
		"0066E16A85E0493F07DF4809AEC084A593748AC3DDE5A6D7AAE1E8B6E5352B2D"
		"71EFBB47D4CAEED5E6D633805D2D323E6FD81B4684B93A2677D45E7421C2C6AE"
		"A259B855A698FD7D13477A1FE53E5A4A6197DBEC5CE95F505B520BCD9570C4A8"
		"265A7E01F89C0C002C59BFEC6CD4A5C109258953EE5EE70CD577EE217AF21FA7"
		"0178F0946C9BF6CA8751793479F6B537737E40B6ED28511D8A2D7E73EB75F8DA"
		"AC912FF906E0AB955B083BAC45A8E5E9B744C8506F37E9B4E749A184B30F43EB"
		"188D855F1B70D71FF3E50C537AC1B0F8974F0FE1A6AD295BA42F6AEC74D123A7"
		"ABEDDE6E2C0711CAB36BE5ACB1A5A11A4B1DB08BA6982EFCCD716929A7741CFC"
		"63AA4435E0B69A9063E880795C3DC5EF3272E11C497A91ACF699FEFEE206227A"
		"44C9FB359FD56AC0A9A75A743CFF6862F17D7259AB075216C0699511643B6439", exp1600, 512);

	hex_to_bin("0", msg0, 1);
	hex_to_bin("A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 512);
	shake128(output, 512, msg0, 0);

	if (are_equal8(output, exp0, 512) == false)
	{
		status = false;
	}

	clear8(output, 512);
	shake128(output, 512, msg1600, 200);

	if (are_equal8(output, exp1600, 512) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear8(hash, 512);
	clear64(state, 25);
	shake128_initialize(state, msg1600, 200);
	cshake128_finalize(state, hash, 512);

	if (are_equal8(hash, exp1600, 512) == false)
	{
		status = false;
	}

	return status;
}

bool shake_256_kat_test()
{
	uint8_t exp0[512];
	uint8_t exp1600[512];
	uint8_t hash[512];
	uint8_t msg0[1];
	uint8_t msg1600[200];
	uint8_t output[512];
	uint64_t state[25];
	bool status;

	hex_to_bin("46B9DD2B0BA88D13233B3FEB743EEB243FCD52EA62B81B82B50C27646ED5762F"
		"D75DC4DDD8C0F200CB05019D67B592F6FC821C49479AB48640292EACB3B7C4BE"
		"141E96616FB13957692CC7EDD0B45AE3DC07223C8E92937BEF84BC0EAB862853"
		"349EC75546F58FB7C2775C38462C5010D846C185C15111E595522A6BCD16CF86"
		"F3D122109E3B1FDD943B6AEC468A2D621A7C06C6A957C62B54DAFC3BE87567D6"
		"77231395F6147293B68CEAB7A9E0C58D864E8EFDE4E1B9A46CBE854713672F5C"
		"AAAE314ED9083DAB4B099F8E300F01B8650F1F4B1D8FCF3F3CB53FB8E9EB2EA2"
		"03BDC970F50AE55428A91F7F53AC266B28419C3778A15FD248D339EDE785FB7F"
		"5A1AAA96D313EACC890936C173CDCD0FAB882C45755FEB3AED96D477FF96390B"
		"F9A66D1368B208E21F7C10D04A3DBD4E360633E5DB4B602601C14CEA737DB3DC"
		"F722632CC77851CBDDE2AAF0A33A07B373445DF490CC8FC1E4160FF118378F11"
		"F0477DE055A81A9EDA57A4A2CFB0C83929D310912F729EC6CFA36C6AC6A75837"
		"143045D791CC85EFF5B21932F23861BCF23A52B5DA67EAF7BAAE0F5FB1369DB7"
		"8F3AC45F8C4AC5671D85735CDDDB09D2B1E34A1FC066FF4A162CB263D6541274"
		"AE2FCC865F618ABE27C124CD8B074CCD516301B91875824D09958F341EF274BD"
		"AB0BAE316339894304E35877B0C28A9B1FD166C796B9CC258A064A8F57E27F2A", exp0, 512);

	hex_to_bin("CD8A920ED141AA0407A22D59288652E9D9F1A7EE0C1E7C1CA699424DA84A904D"
		"2D700CAAE7396ECE96604440577DA4F3AA22AEB8857F961C4CD8E06F0AE6610B"
		"1048A7F64E1074CD629E85AD7566048EFC4FB500B486A3309A8F26724C0ED628"
		"001A1099422468DE726F1061D99EB9E93604D5AA7467D4B1BD6484582A384317"
		"D7F47D750B8F5499512BB85A226C4243556E696F6BD072C5AA2D9B69730244B5"
		"6853D16970AD817E213E470618178001C9FB56C54FEFA5FEE67D2DA524BB3B0B"
		"61EF0E9114A92CDBB6CCCB98615CFE76E3510DD88D1CC28FF99287512F24BFAF"
		"A1A76877B6F37198E3A641C68A7C42D45FA7ACC10DAE5F3CEFB7B735F12D4E58"
		"9F7A456E78C0F5E4C4471FFFA5E4FA0514AE974D8C2648513B5DB494CEA84715"
		"6D277AD0E141C24C7839064CD08851BC2E7CA109FD4E251C35BB0A04FB05B364"
		"FF8C4D8B59BC303E25328C09A882E952518E1A8AE0FF265D61C465896973D749"
		"0499DC639FB8502B39456791B1B6EC5BCC5D9AC36A6DF622A070D43FED781F5F"
		"149F7B62675E7D1A4D6DEC48C1C7164586EAE06A51208C0B791244D307726505"
		"C3AD4B26B6822377257AA152037560A739714A3CA79BD605547C9B78DD1F596F"
		"2D4F1791BC689A0E9B799A37339C04275733740143EF5D2B58B96A363D4E0807"
		"6A1A9D7846436E4DCA5728B6F760EEF0CA92BF0BE5615E96959D767197A0BEEB", exp1600, 512);

	hex_to_bin("0", msg0, 1);
	hex_to_bin("A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 512);
	shake256(output, 512, msg0, 0);

	if (are_equal8(output, exp0, 512) == false)
	{
		status = false;
	}

	clear8(output, 512);
	shake256(output, 512, msg1600, 200);

	if (are_equal8(output, exp1600, 512) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear8(hash, 512);
	clear64(state, 25);
	shake256_initialize(state, msg1600, 200);
	cshake256_finalize(state, hash, 512);

	if (are_equal8(hash, exp1600, 512) == false)
	{
		status = false;
	}

	return status;
}

bool cshake_128_kat_test()
{
	uint8_t cust[15];
	uint8_t exp256a[32];
	uint8_t exp256b[32];
	uint8_t msg32[4];
	uint8_t msg1600[200];
	uint8_t name[1];
	uint8_t output[32];
	uint64_t state[25];
	bool status;

	hex_to_bin("456D61696C205369676E6174757265", cust, 15);

	hex_to_bin("C1C36925B6409A04F1B504FCBCA9D82B4017277CB5ED2B2065FC1D3814D5AAF5", exp256a, 32);
	hex_to_bin("C5221D50E4F822D96A2E8881A961420F294B7B24FE3D2094BAED2C6524CC166B", exp256b, 32);

	hex_to_bin("00010203", msg32, 4);
	hex_to_bin("000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F"
		"202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F"
		"404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F"
		"606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F"
		"808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F"
		"A0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF"
		"C0C1C2C3C4C5C6C7", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 32);
	cshake128(output, 32, msg32, 4, name, 0, cust, 15);

	if (are_equal8(output, exp256a, 32) == false)
	{
		status = false;
	}

	clear8(output, 32);
	cshake128(output, 32, msg1600, 200, name, 0, cust, 15);

	if (are_equal8(output, exp256b, 32) == false)
	{
		status = false;
	}

	/* test long-form api */

	uint8_t hashb[CSHAKE128_RATE];
	clear8(hashb, CSHAKE128_RATE);
	clear64(state, 25);
	cshake128_initialize(state, name, 0, cust, 15);
	cshake128_update(state, msg1600, 200);
	cshake128_squeezeblocks(state, hashb, 1);

	if (are_equal8(hashb, exp256b, 32) == false)
	{
		status = false;
	}

	return status;
}

bool cshake_256_kat_test()
{
	uint8_t cust[15];
	uint8_t exp512a[64];
	uint8_t exp512b[64];
	uint8_t msg32[4];
	uint8_t msg1600[200];
	uint8_t name[1];
	uint8_t output[64];
	uint64_t state[25];
	bool status;

	hex_to_bin("456D61696C205369676E6174757265", cust, 15);

	hex_to_bin("D008828E2B80AC9D2218FFEE1D070C48B8E4C87BFF32C9699D5B6896EEE0EDD1"
		"64020E2BE0560858D9C00C037E34A96937C561A74C412BB4C746469527281C8C", exp512a, 64);
	hex_to_bin("07DC27B11E51FBAC75BC7B3C1D983E8B4B85FB1DEFAF218912AC864302730917"
		"27F42B17ED1DF63E8EC118F04B23633C1DFB1574C8FB55CB45DA8E25AFB092BB", exp512b, 64);

	hex_to_bin("00010203", msg32, 4);
	hex_to_bin("000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F"
		"202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F"
		"404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F"
		"606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F"
		"808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F"
		"A0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF"
		"C0C1C2C3C4C5C6C7", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 64);
	cshake256(output, 64, msg32, 4, name, 0, cust, 15);

	if (are_equal8(output, exp512a, 64) == false)
	{
		status = false;
	}

	clear8(output, 64);
	cshake256(output, 64, msg1600, 200, name, 0, cust, 15);

	if (are_equal8(output, exp512b, 64) == false)
	{
		status = false;
	}

	/* test long-form api */

	uint8_t hashb[CSHAKE256_RATE];
	clear8(hashb, CSHAKE256_RATE);
	clear64(state, 25);
	cshake256_initialize(state, name, 0, cust, 15);
	cshake256_update(state, msg1600, 200);
	cshake256_squeezeblocks(state, hashb, 1);

	if (are_equal8(hashb, exp512b, 64) == false)
	{
		status = false;
	}

	return status;
}

bool cshake_simple_128_kat_test()
{
	uint8_t exp0[512];
	uint8_t exp1600[512];
	uint8_t hash[CSHAKE128_RATE * 4];
	uint8_t msg0[1];
	uint8_t msg1600[200];
	uint8_t output[512];
	uint64_t state[25];
	bool status;

	hex_to_bin("076CB8EE5DE4E1FFCE8680A70C5A1635BCA6C310A6BC82C67ABBB7C4B1386514"
		"936DFF1A1C9BF294B56E529191AAD008FF1BA11343937DC6FFE9BFE14F0FB7DE"
		"2F078A4F35C03CDF2DD4101612848E1FD757B96846FB96E0EA363AB017007119"
		"0A6EB702F971E4F9059EE5BD745488972FE1513228845A601BFA1C63112BDF63"
		"F0C24C7F1BCAE29AB2189FCC379657417B1A4048E950B971BC8E3F91F447C196"
		"A6B1DCFA74EFB4B63A5346EEFDAA554177CDE163FC48EE61190FAB43BCD2B7D3"
		"18C5E79664D8EC07FD2FB62E35D1512E3BCC1BBACC9EAB72B82F6AB2F51CDB7C"
		"F738F63EBEE19322AE1DB93F7169A1EF689104DD4DBB827483271B296632A9FE"
		"1830C15BFF9D3817978213797716A53DEBD78FE839743C383D5BCB62EE1CEA4C"
		"A7885C9316AC9941B6EBECCF12BCC663FE005265223349DFD06DC73DE2DDA762"
		"79F82E17704CF3F1A7FD3D72AB99B502311F092CB44C1F6EDD0535DD7FF6A5CB"
		"BC3C9D39DE73D642AD351C65074856C92AACABB9551D16993DFBA9E159E78FBA"
		"5B9753744A42F06DF8ECB7D23DAAB544A97AAE532C75B31D122124665FAA9E7C"
		"195D8E24DDD7E83C6D301A66B4C9CFF4F9985F1759670758D5A79AD5583BDAF7"
		"165FFBA87F98FE5592352E97185CA446E3109511808A9E462DD0AACF28624B6D"
		"76BE60C19132F4FFAAD304FD3647A64742F361E4E94EFAA9571C51B676D23198", exp0, 512);

	hex_to_bin("6B914E9D716F1CD47B83CCF491565DD2BF6860C4CF33A4CBB28D44DB6CBFF703"
		"A7C56700BB660FCCF8496F7C52BE9595968ED4E5710915F33AFA1E52164F9666"
		"3C797DA1DFA5E7E02806475042B7A4A225CD70EE8BDBA8B7C28160897B6146EE"
		"F1904DC43E9F17BC7B316F29845D3DCF67D2A3B3A050931ACCEA6A1AB9ABF0B2"
		"A2C9B3D68DC5556CAD899959237547ADAD67816AB075BEFD2A0EA200019B4F0B"
		"E151772A1B0BBB5692F70C981803C4C241D8837B0FF1BDAB9C062D6B9D37D1C4"
		"B1BD23DD80A671A51B26049F730161176861F25320E6B697D191A99740132DED"
		"0987D0DDDBFED26AFD2AA08F243B00FE6A72F8C5893E0E083BD9AC1D019F7AB8"
		"ACE897AA149DE26D3ACAA016F3BD234EFA7D95D97CE751934857FCD80FAB3DDD"
		"91A7A7D12CDE81EE7987FB79B78861D33C2323A77AA44DEF717317407CF1399E"
		"22142DDA59EEFB22F73F277713A1E25CAEFDC9F7CDBB50F47759FEA6B58EA409"
		"2BFEA040C10ACCAD098D7CECA6443F5CB543E07E5F7BBB837663636AE115DFBF"
		"FB6DAAB613C31F21D0E4C881D8800C996180C89DD719A0C958D2D1A85E8E804A"
		"E48E503A471A83A011549EB7F0CA3A4EB426C04FE9FD345E765E2354D84CD778"
		"4B63CB1506759B9BCEA0064F41FB933BD859FAACCEF2B3FB1042544B4B2CA2F7"
		"C2E9CAF11BC685F558CD5C324C7FFDAE8812730741BAD2EFBC3268DCC7748125", exp1600, 512);

	hex_to_bin("0", msg0, 1);
	hex_to_bin("A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 512);
	cshake128_simple(output, 512, 1, msg0, 0);

	if (are_equal8(output, exp0, 512) == false)
	{
		status = false;
	}

	clear8(output, 512);
	cshake128_simple(output, 512, 1, msg1600, 200);

	if (are_equal8(output, exp1600, 512) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear8(hash, CSHAKE128_RATE * 4);
	clear64(state, 25);
	cshake128_simple_initialize(state, 1, msg1600, 200);
	cshake128_simple_squeezeblocks(state, hash, 4);

	if (are_equal8(hash, exp1600, 512) == false)
	{
		status = false;
	}

	return status;
}

bool cshake_simple_256_kat_test()
{
	uint8_t exp0[512];
	uint8_t exp1600[512];
	uint8_t hash[CSHAKE256_RATE * 4];
	uint8_t msg0[1];
	uint8_t msg1600[200];
	uint8_t output[512];
	uint64_t state[25];
	bool status;

	hex_to_bin("2D706C4E24701AF4950286EA2C5491C92C1A2519ECE7B3326B1A6F25A86031A3"
		"D6336778FEEB2A5E59798195A2E87DDF4E65A0E62A72F2511249E1784500E9BF"
		"4723A84A82BA6BEB304BE568D863DB63AF006766B435D970B29E2450B225107A"
		"6ACE64B144D9F3FD00A90FC2C0B0673CB41860C9D003E8AB062D88B6C8460882"
		"5FB19430986B943A271202A9844859AC1002F25928449FB76D09BC3CE4792151"
		"D32EBFAF53846D29A4173406494B1C7299CA01F8203F475720C5EC8B025BBCEF"
		"AFEEF4F97803927BEC6C050CCCE5E39E339B7207F67698BD7862986297577CC4"
		"D91F9F17BDD90E7FBD5D937231BB51AF25C71B1183D4389226AE61B83B58F7D6"
		"6320AC4C9BFF522855E9A55A1510A2B8CA7F1124656A2BAADCEFCD6BBC0DAEF4"
		"14037BC804325D5D81558126BAE9905B4CAB03793BCDCB44A4167BE8237E316C"
		"739B067602C123A8F7F00E85A56D5E763D080C81BBBA1878A0E7BA6C45212FC0"
		"5566220F87CADA00CBFCD4AB644D456BC680B3DAEE29A993A6A0E204455625C3"
		"9126E7073954912192F9627D1CFF21746F5C446BDC8DED31416DEA046CD16F03"
		"A812757F16659F7C2AF2744B5F5085F08A173FBB1B503F647E4F332F777C37FB"
		"98FDC37E735DFD771C4578017A1555BF0178B8EED1FB357A38BEFF44A753E217"
		"8C2210AF8858780CE045EE6FBA8DF79926991BE12D9E39536D9091254E1DF781", exp0, 512);

	hex_to_bin("E53E39A5847B628D4FBDF0A08499088DC0ED961C8E279B0D67CE58DC69CEAAE5"
		"3C3A3BC9B1804B5A15632F7CD70A725503AB0EA9C15785D706597F9326965938"
		"000B30EB83AEB98872C228F5ED5A14144192AC32EFE197F61641E199E8BC1396"
		"C24DEF0A23DE9769F068DAAF177755C751E2524AF2DD9FB1231AB7A6B6E9DEE6"
		"993B522C8A46CDAB833DD917BB1E57B969E23CDFF5AE1C3EC3607E8B30F80DF6"
		"F26F60C58D8A99A201B469CA3D8A3E269E1FAA5C9A226A6D282D31634192B493"
		"45993B1A8F4BE819198428CC703F62F86785042C3BFDA9AFBFA364CBBFC89B53"
		"27CCEC0DDEC9607CD91482F5EA2F8DE6441176ED0D3D65CFCC6F8381B06E2AA4"
		"D6546CE31CE987FC20532CD684684FF684C3D1733E3CBAEC74DFB68FC1AAC92C"
		"6DC181B1D16CB0B2818FB1975982426466842F52CB524FFBAA14710511D5E78B"
		"646BB12E6419F1CD809BCBCC8D2A6F3AACA4C2850B682685D2ABB173EB67A428"
		"ECDEAF8A6FA909442445E389A6180BE15F6E954943BCE0063FB2FED62AC18340"
		"0F42223082FD7D3A5FE03413F802B24D9EFB38E807FD53465649A82597AB6006"
		"D5B61F0F73266B8BD6463933149353FAF355AE23178CD471F665514215A0E51E"
		"F47334EB4319E5A73162FD4892FBF202602B2AFDDEF217D4AD4DF574052BE30A"
		"96CDF5212B3B697C332196487AAA2433F72D2B8EA018E9DBC9658D8B659848E8", exp1600, 512);

	hex_to_bin("0", msg0, 1);
	hex_to_bin("A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3A3"
		"A3A3A3A3A3A3A3A3", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 512);
	cshake256_simple(output, 512, 1, msg0, 0);

	if (are_equal8(output, exp0, 512) == false)
	{
		status = false;
	}

	clear8(output, 512);
	cshake256_simple(output, 512, 1, msg1600, 200);

	if (are_equal8(output, exp1600, 512) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear8(hash, CSHAKE256_RATE * 4);
	clear64(state, 25);
	cshake256_simple_initialize(state, 1, msg1600, 200);
	cshake256_simple_squeezeblocks(state, hash, 4);

	if (are_equal8(hash, exp1600, 512) == false)
	{
		status = false;
	}

	return status;
}

bool kmac_128_kat_test()
{
	uint8_t cust0[1];
	uint8_t cust168[21];
	uint8_t exp256a[32];
	uint8_t exp256b[32];
	uint8_t exp256c[32];
	uint8_t msg32[4];
	uint8_t msg1600[200];
	uint8_t key256[32];
	uint8_t output[32];
	uint64_t state[25];
	bool status;

	hex_to_bin("4D7920546167676564204170706C69636174696F6E", cust168, 21);

	hex_to_bin("E5780B0D3EA6F7D3A429C5706AA43A00FADBD7D49628839E3187243F456EE14E", exp256a, 32);
	hex_to_bin("3B1FBA963CD8B0B59E8C1A6D71888B7143651AF8BA0A7070C0979E2811324AA5", exp256b, 32);
	hex_to_bin("1F5B4E6CCA02209E0DCB5CA635B89A15E271ECC760071DFD805FAA38F9729230", exp256c, 32);

	hex_to_bin("404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F", key256, 32);

	hex_to_bin("00010203", msg32, 4);
	hex_to_bin("000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F"
		"202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F"
		"404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F"
		"606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F"
		"808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F"
		"A0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF"
		"C0C1C2C3C4C5C6C7", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 32);
	kmac128(output, 32, msg32, 4, key256, 32, cust0, 0);

	if (are_equal8(output, exp256a, 32) == false)
	{
		status = false;
	}

	clear8(output, 32);
	kmac128(output, 32, msg32, 4, key256, 32, cust168, 21);

	if (are_equal8(output, exp256b, 32) == false)
	{
		status = false;
	}

	clear8(output, 32);
	kmac128(output, 32, msg1600, 200, key256, 32, cust168, 21);

	if (are_equal8(output, exp256c, 32) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear64(state, 25);
	clear8(output, 32);

	kmac128_initialize(state, key256, 32, cust168, 21);
	kmac128_blockupdate(state, msg1600, 1);
	kmac128_finalize(state, output, 32, msg1600 + CSHAKE128_RATE, 200 - CSHAKE128_RATE);

	if (are_equal8(output, exp256c, 32) == false)
	{
		status = false;
	}

	return status;
}

bool kmac_256_kat_test()
{
	uint8_t cust0[1];
	uint8_t cust168[21];
	uint8_t exp256a[64];
	uint8_t exp256b[64];
	uint8_t exp256c[64];
	uint8_t msg32[4];
	uint8_t msg1600[200];
	uint8_t key256[32];
	uint8_t output[64];
	uint64_t state[25];
	bool status;

	hex_to_bin("4D7920546167676564204170706C69636174696F6E", cust168, 21);

	hex_to_bin("20C570C31346F703C9AC36C61C03CB64C3970D0CFC787E9B79599D273A68D2F7"
		"F69D4CC3DE9D104A351689F27CF6F5951F0103F33F4F24871024D9C27773A8DD", exp256a, 64);
	hex_to_bin("75358CF39E41494E949707927CEE0AF20A3FF553904C86B08F21CC414BCFD691"
		"589D27CF5E15369CBBFF8B9A4C2EB17800855D0235FF635DA82533EC6B759B69", exp256b, 64);
	hex_to_bin("B58618F71F92E1D56C1B8C55DDD7CD188B97B4CA4D99831EB2699A837DA2E4D9"
		"70FBACFDE50033AEA585F1A2708510C32D07880801BD182898FE476876FC8965", exp256c, 64);

	hex_to_bin("404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F", key256, 32);

	hex_to_bin("00010203", msg32, 4);
	hex_to_bin("000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F"
		"202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F"
		"404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F"
		"606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F"
		"808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F"
		"A0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF"
		"C0C1C2C3C4C5C6C7", msg1600, 200);

	status = true;

	/* test compact api */

	clear8(output, 64);
	kmac256(output, 64, msg32, 4, key256, 32, cust168, 21);

	if (are_equal8(output, exp256a, 64) == false)
	{
		status = false;
	}

	clear8(output, 64);
	kmac256(output, 64, msg1600, 200, key256, 32, cust0, 0);

	if (are_equal8(output, exp256b, 64) == false)
	{
		status = false;
	}

	clear8(output, 64);
	kmac256(output, 64, msg1600, 200, key256, 32, cust168, 21);

	if (are_equal8(output, exp256c, 64) == false)
	{
		status = false;
	}

	/* test long-form api */

	clear64(state, 25);
	clear8(output, 64);

	kmac256_initialize(state, key256, 32, cust168, 21);
	kmac256_blockupdate(state, msg1600, 1);
	kmac256_finalize(state, output, 64, msg1600 + CSHAKE256_RATE, 200 - CSHAKE256_RATE);

	if (are_equal8(output, exp256c, 64) == false)
	{
		status = false;
	}

	return status;
}